<!DOCTYPE html>
<html lang="tr" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Scanner V3.4 - Gelişmiş Ağ Tarayıcı</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .device-card {
            transition: transform 0.2s;
            cursor: pointer;
        }
        .device-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .confidence-badge {
            font-size: 0.8em;
        }
        .discovery-method {
            font-size: 0.7em;
            margin: 1px;
        }
        .loading {
            display: none;
        }
        .scan-options {
            background: var(--bs-secondary-bg);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .device-type-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .modal-xl {
            max-width: 90%;
        }
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .user-menu {
            position: fixed;
            top: 20px;
            right: 80px;
            z-index: 1000;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .dark-mode .sidebar {
            background: #1a1a1a !important;
            color: #ffffff !important;
        }
        .dark-mode .main-content {
            background: #2d2d2d !important;
            color: #ffffff !important;
        }
        .dark-mode .card {
            background: #3a3a3a !important;
            border-color: #555 !important;
        }
        .dark-mode .table {
            color: #ffffff !important;
        }
        .dark-mode .modal-content {
            background: #3a3a3a !important;
            color: #ffffff !important;
        }
    </style>
</head>
<body>
    <!-- Tema Değiştirme Butonu -->
    <div class="theme-toggle">
        <button class="btn btn-outline-secondary" onclick="toggleTheme()" id="themeToggle">
            <i class="fas fa-moon" id="themeIcon"></i>
        </button>
    </div>

    <!-- Kullanıcı Menüsü -->
    <div class="user-menu dropdown">
        <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
            <i class="fas fa-user"></i> Kullanıcı
        </button>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#" onclick="showProfile()">
                <i class="fas fa-user-circle"></i> Profil
            </a></li>
            <li><a class="dropdown-item" href="#" onclick="showSettings()">
                <i class="fas fa-cog"></i> Ayarlar
            </a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Çıkış
            </a></li>
        </ul>
    </div>

    <!-- Bildirim Butonu -->
    <div class="position-fixed" style="top: 20px; right: 200px; z-index: 1000;">
        <button class="btn btn-outline-warning position-relative" onclick="showNotifications()">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" id="notificationCount" style="display: none;">0</span>
        </button>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 bg-dark text-white p-4 sidebar" style="min-height: 100vh;">
                <h3 class="mb-4">
                    <i class="fas fa-network-wired"></i>
                    IP Scanner V3.4
                </h3>
                
                <!-- Tarama Seçenekleri -->
                <div class="mb-4">
                    <h5>Tarama Türü</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="scanType" id="basicScan" value="basic" checked>
                        <label class="form-check-label" for="basicScan">
                            <i class="fas fa-search"></i> Temel Tarama
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="scanType" id="fastScan" value="fast">
                        <label class="form-check-label" for="fastScan">
                            <i class="fas fa-bolt"></i> Hızlı Tarama (Port Yok)
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="scanType" id="advancedScan" value="advanced">
                        <label class="form-check-label" for="advancedScan">
                            <i class="fas fa-microscope"></i> Gelişmiş Tarama
                        </label>
                    </div>
                </div>

                <!-- Gelişmiş Tarama Seçenekleri -->
                <div id="advancedOptions" class="mb-4" style="display: none;">
                    <h5>Gelişmiş Seçenekler</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="enableNmap" checked>
                        <label class="form-check-label" for="enableNmap">
                            <i class="fas fa-fingerprint"></i> Nmap OS Tespiti
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="enableDhcp" checked>
                        <label class="form-check-label" for="enableDhcp">
                            <i class="fas fa-broadcast-tower"></i> DHCP Keşfi
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="enableNetbios" checked>
                        <label class="form-check-label" for="enableNetbios">
                            <i class="fas fa-desktop"></i> NetBIOS Keşfi
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="enableMdns" checked>
                        <label class="form-check-label" for="enableMdns">
                            <i class="fas fa-apple-alt"></i> mDNS Keşfi
                        </label>
                    </div>
                </div>

                <!-- IP Aralığı -->
                <div class="mb-4">
                    <label for="ipRange" class="form-label">IP Aralığı</label>
                    <input type="text" class="form-control" id="ipRange" value="192.168.1.0/24">
                </div>

                <!-- Tarama Butonu -->
                <button class="btn btn-primary w-100 mb-3" onclick="startScan()">
                    <i class="fas fa-play"></i> Taramayı Başlat
                </button>

                <!-- İstatistikler -->
                <div class="mt-4">
                    <h5>İstatistikler</h5>
                    <div id="stats">
                        <p class="text-muted">Henüz tarama yapılmadı</p>
                    </div>
                </div>

                <!-- Hızlı Eylemler -->
                <div class="mt-4">
                    <h5>Hızlı Eylemler</h5>
                    <button class="btn btn-outline-light btn-sm w-100 mb-2" onclick="generateNetworkMap()">
                        <i class="fas fa-project-diagram"></i> Ağ Haritası
                    </button>
                    <button class="btn btn-outline-light btn-sm w-100 mb-2" onclick="generateReports()">
                        <i class="fas fa-file-alt"></i> Rapor Oluştur
                    </button>
                    <button class="btn btn-outline-light btn-sm w-100 mb-2" onclick="showEmailModal()">
                        <i class="fas fa-envelope"></i> E-posta Gönder
                    </button>
                    <button class="btn btn-outline-light btn-sm w-100" onclick="startMonitoring()">
                        <i class="fas fa-eye"></i> Ağ İzleme
                    </button>
                </div>
            </div>

            <!-- Ana İçerik -->
            <div class="col-md-9 p-4 main-content">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Ağ Cihazları</h2>
                    <div class="loading" id="loading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Taranıyor...</span>
                        </div>
                        <span class="ms-2">Taranıyor...</span>
                    </div>
                </div>

                <!-- Cihaz Listesi -->
                <div id="deviceList" class="row">
                    <div class="col-12">
                        <p class="text-muted">Taramayı başlatmak için sol paneldeki butonu kullanın.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cihaz Detayları Modal -->
    <div class="modal fade" id="deviceModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cihaz Detayları</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="deviceModalBody">
                    <!-- Cihaz detayları buraya yüklenecek -->
                </div>
            </div>
        </div>
    </div>

    <!-- E-posta Modal -->
    <div class="modal fade" id="emailModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">E-posta ile Rapor Gönder</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="emailTo" class="form-label">Alıcı E-posta</label>
                        <input type="email" class="form-control" id="emailTo" required>
                    </div>
                    <div class="mb-3">
                        <label for="reportType" class="form-label">Rapor Türü</label>
                        <select class="form-select" id="reportType">
                            <option value="html">HTML Rapor</option>
                            <option value="pdf">PDF Rapor</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="smtpServer" class="form-label">SMTP Sunucu</label>
                        <input type="text" class="form-control" id="smtpServer" placeholder="smtp.gmail.com">
                    </div>
                    <div class="mb-3">
                        <label for="smtpPort" class="form-label">SMTP Port</label>
                        <input type="number" class="form-control" id="smtpPort" value="587">
                    </div>
                    <div class="mb-3">
                        <label for="smtpUser" class="form-label">E-posta Adresi</label>
                        <input type="email" class="form-control" id="smtpUser">
                    </div>
                    <div class="mb-3">
                        <label for="smtpPass" class="form-label">Şifre</label>
                        <input type="password" class="form-control" id="smtpPass">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="button" class="btn btn-primary" onclick="sendEmail()">Gönder</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profil Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Kullanıcı Profili</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <i class="fas fa-user-circle" style="font-size: 4rem; color: var(--bs-primary);"></i>
                        <h4 class="mt-2">IP Scanner Kullanıcısı</h4>
                        <p class="text-muted">Ağ Yöneticisi</p>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Kullanım İstatistikleri</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-search"></i> Toplam Tarama: 127</li>
                                <li><i class="fas fa-eye"></i> İzleme Saati: 48h</li>
                                <li><i class="fas fa-file-alt"></i> Rapor Sayısı: 23</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Son Aktiviteler</h6>
                            <ul class="list-unstyled">
                                <li><small class="text-muted">2 saat önce - Ağ taraması</small></li>
                                <li><small class="text-muted">1 gün önce - Rapor oluşturuldu</small></li>
                                <li><small class="text-muted">3 gün önce - E-posta gönderildi</small></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ayarlar Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Uygulama Ayarları</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Görünüm</h6>
                            <div class="mb-3">
                                <label class="form-label">Tema</label>
                                <select class="form-select" id="themeSelect" onchange="changeTheme(this.value)">
                                    <option value="light">Açık Tema</option>
                                    <option value="dark">Koyu Tema</option>
                                    <option value="auto">Otomatik</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Dil</label>
                                <select class="form-select">
                                    <option value="tr">Türkçe</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Bildirimler</h6>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                                <label class="form-check-label" for="emailNotifications">
                                    E-posta Bildirimleri
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="anomalyAlerts" checked>
                                <label class="form-check-label" for="anomalyAlerts">
                                    Anomali Uyarıları
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="scanComplete" checked>
                                <label class="form-check-label" for="scanComplete">
                                    Tarama Tamamlandı
                                </label>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Tarama Ayarları</h6>
                            <div class="mb-3">
                                <label class="form-label">Varsayılan IP Aralığı</label>
                                <input type="text" class="form-control" value="192.168.1.0/24">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Tarama Timeout (saniye)</label>
                                <input type="number" class="form-control" value="3">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Güvenlik</h6>
                            <div class="mb-3">
                                <label class="form-label">Oturum Süresi</label>
                                <select class="form-select">
                                    <option value="1">1 Saat</option>
                                    <option value="8" selected>8 Saat</option>
                                    <option value="24">24 Saat</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <button class="btn btn-outline-secondary btn-sm" onclick="exportSettings()">
                                    <i class="fas fa-download"></i> Ayarları Dışa Aktar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="button" class="btn btn-primary" onclick="saveSettings()">Kaydet</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bildirimler Modal -->
    <div class="modal fade" id="notificationsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Bildirimler</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="notificationsList">
                    <!-- Bildirimler buraya yüklenecek -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let devices = [];
        let currentTheme = localStorage.getItem('theme') || 'light';
        let notifications = [];

        // Sayfa yüklendiğinde tema ayarla
        document.addEventListener('DOMContentLoaded', function() {
            applyTheme(currentTheme);
            loadNotifications();
        });

        // Tema değiştirme
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(currentTheme);
            localStorage.setItem('theme', currentTheme);
        }

        function applyTheme(theme) {
            const html = document.documentElement;
            const themeIcon = document.getElementById('themeIcon');
            const themeSelect = document.getElementById('themeSelect');
            
            html.setAttribute('data-bs-theme', theme);
            
            if (theme === 'dark') {
                themeIcon.className = 'fas fa-sun';
                document.body.classList.add('dark-mode');
            } else {
                themeIcon.className = 'fas fa-moon';
                document.body.classList.remove('dark-mode');
            }
            
            if (themeSelect) {
                themeSelect.value = theme;
            }
        }

        function changeTheme(theme) {
            currentTheme = theme;
            applyTheme(theme);
            localStorage.setItem('theme', theme);
        }

        // Kullanıcı menüsü fonksiyonları
        function showProfile() {
            new bootstrap.Modal(document.getElementById('profileModal')).show();
        }

        function showSettings() {
            new bootstrap.Modal(document.getElementById('settingsModal')).show();
        }

        function logout() {
            if (confirm('Çıkış yapmak istediğinizden emin misiniz?')) {
                // Çıkış işlemleri
                alert('Çıkış yapıldı');
            }
        }

        function saveSettings() {
            // Ayarları kaydet
            alert('Ayarlar kaydedildi!');
            bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
        }

        function exportSettings() {
            // Ayarları dışa aktar
            const settings = {
                theme: currentTheme,
                notifications: {
                    email: document.getElementById('emailNotifications').checked,
                    anomaly: document.getElementById('anomalyAlerts').checked,
                    scanComplete: document.getElementById('scanComplete').checked
                }
            };
            
            const blob = new Blob([JSON.stringify(settings, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ip_scanner_settings.json';
            a.click();
        }

        // Bildirim sistemi
        function loadNotifications() {
            // Örnek bildirimler
            notifications = [
                {
                    id: 1,
                    type: 'warning',
                    title: 'Anomali Tespit Edildi',
                    message: '192.168.1.100 adresinden anormal trafik tespit edildi',
                    time: '2 dakika önce',
                    read: false
                },
                {
                    id: 2,
                    type: 'info',
                    title: 'Tarama Tamamlandı',
                    message: 'Ağ taraması başarıyla tamamlandı. 15 cihaz tespit edildi.',
                    time: '1 saat önce',
                    read: true
                },
                {
                    id: 3,
                    type: 'success',
                    title: 'Rapor Gönderildi',
                    message: 'Ağ raporu admin@company.com adresine gönderildi.',
                    time: '3 saat önce',
                    read: true
                }
            ];
            
            updateNotificationCount();
        }

        function updateNotificationCount() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationCount');
            
            if (unreadCount > 0) {
                badge.style.display = 'flex';
                badge.textContent = unreadCount;
            } else {
                badge.style.display = 'none';
            }
        }

        function showNotifications() {
            const modalBody = document.getElementById('notificationsList');
            
            if (notifications.length === 0) {
                modalBody.innerHTML = '<p class="text-muted">Bildirim bulunmuyor.</p>';
            } else {
                modalBody.innerHTML = notifications.map(notification => `
                    <div class="alert alert-${notification.type === 'warning' ? 'warning' : notification.type === 'info' ? 'info' : 'success'} ${notification.read ? 'opacity-75' : ''}">
                        <div class="d-flex justify-content-between">
                            <div>
                                <strong>${notification.title}</strong>
                                <p class="mb-0">${notification.message}</p>
                            </div>
                            <small class="text-muted">${notification.time}</small>
                        </div>
                    </div>
                `).join('');
            }
            
            // Tüm bildirimleri okundu olarak işaretle
            notifications.forEach(n => n.read = true);
            updateNotificationCount();
            
            new bootstrap.Modal(document.getElementById('notificationsModal')).show();
        }

        function addNotification(type, title, message) {
            const notification = {
                id: Date.now(),
                type: type,
                title: title,
                message: message,
                time: 'Şimdi',
                read: false
            };
            
            notifications.unshift(notification);
            updateNotificationCount();
        }

        // Ağ izleme
        function startMonitoring() {
            addNotification('info', 'Ağ İzleme Başlatıldı', 'Ağ trafiği izlenmeye başlandı. Anomali tespit edildiğinde bildirim alacaksınız.');
            
            // Simüle edilmiş anomali tespiti
            setTimeout(() => {
                addNotification('warning', 'Anomali Tespit Edildi', '192.168.1.100 adresinden anormal trafik tespit edildi. Detaylar için tıklayın.');
            }, 5000);
        }

        // Tarama türü değişikliği
        document.querySelectorAll('input[name="scanType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const advancedOptions = document.getElementById('advancedOptions');
                if (this.value === 'advanced') {
                    advancedOptions.style.display = 'block';
                } else {
                    advancedOptions.style.display = 'none';
                }
            });
        });

        function startScan() {
            const scanType = document.querySelector('input[name="scanType"]:checked').value;
            const ipRange = document.getElementById('ipRange').value;
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('deviceList').innerHTML = '<div class="col-12"><p class="text-muted">Taranıyor...</p></div>';

            if (scanType === 'advanced') {
                // Gelişmiş tarama
                const advancedOptions = {
                    ip_range: ipRange,
                    enable_nmap: document.getElementById('enableNmap').checked,
                    enable_dhcp: document.getElementById('enableDhcp').checked,
                    enable_netbios: document.getElementById('enableNetbios').checked,
                    enable_mdns: document.getElementById('enableMdns').checked
                };

                fetch('/api/advanced-scan', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(advancedOptions)
                })
                .then(response => response.json())
                .then(data => {
                    devices = data.devices;
                    displayDevices();
                    updateStats();
                    document.getElementById('loading').style.display = 'none';
                    
                    // Tarama tamamlandı bildirimi
                    if (document.getElementById('scanComplete').checked) {
                        addNotification('success', 'Tarama Tamamlandı', `${devices.length} cihaz tespit edildi.`);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('loading').style.display = 'none';
                });
            } else if (scanType === 'fast') {
                // Hızlı tarama (port tarama kapalı)
                fetch('/api/scan', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ip_range: ipRange, port_scan: false})
                })
                .then(response => response.json())
                .then(data => {
                    devices = data.devices;
                    displayDevices();
                    updateStats();
                    document.getElementById('loading').style.display = 'none';
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('loading').style.display = 'none';
                });
            } else {
                // Temel tarama (port tarama açık)
                fetch('/api/scan', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ip_range: ipRange, port_scan: true})
                })
                .then(response => response.json())
                .then(data => {
                    devices = data.devices;
                    displayDevices();
                    updateStats();
                    document.getElementById('loading').style.display = 'none';
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('loading').style.display = 'none';
                });
            }
        }

        function displayDevices() {
            const deviceList = document.getElementById('deviceList');
            
            if (devices.length === 0) {
                deviceList.innerHTML = '<div class="col-12"><p class="text-muted">Cihaz bulunamadı.</p></div>';
                return;
            }

            deviceList.innerHTML = devices.map(device => `
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card device-card" onclick="showDeviceDetails('${device.ip}')">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <span class="device-type-icon">${getDeviceIcon(device.device_type)}</span>
                                <div>
                                    <h6 class="card-title mb-0">${device.ip}</h6>
                                    <small class="text-muted">${device.device_type || 'Bilinmeyen Cihaz'}</small>
                                </div>
                            </div>
                            <p class="card-text">
                                <small class="text-muted">
                                    <i class="fas fa-microchip"></i> ${device.mac}<br>
                                    <i class="fas fa-industry"></i> ${device.vendor || 'Bilinmeyen'}<br>
                                    ${device.confidence ? `<span class="badge bg-${getConfidenceColor(device.confidence)} confidence-badge">Güven: ${device.confidence}%</span>` : ''}
                                </small>
                            </p>
                            ${device.discovery_methods ? `
                                <div class="mt-2">
                                    ${device.discovery_methods.map(method => 
                                        `<span class="badge bg-secondary discovery-method">${method}</span>`
                                    ).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getDeviceIcon(deviceType) {
            const icons = {
                'Windows Cihazı': 'fab fa-windows',
                'Linux Cihazı': 'fab fa-linux',
                'Apple Cihazı': 'fab fa-apple',
                'iOS Cihazı': 'fab fa-app-store-ios',
                'Android Cihazı': 'fab fa-android',
                'Router/Modem': 'fas fa-wifi',
                'Web Sunucu': 'fas fa-server',
                'FTP Sunucu': 'fas fa-file-upload',
                'Bilinmeyen Cihaz': 'fas fa-question-circle'
            };
            return icons[deviceType] || 'fas fa-question-circle';
        }

        function getConfidenceColor(confidence) {
            if (confidence >= 90) return 'success';
            if (confidence >= 70) return 'warning';
            return 'danger';
        }

        function showDeviceDetails(ip) {
            fetch(`/api/device-details/${ip}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'ok') {
                        const device = data.device;
                        const modalBody = document.getElementById('deviceModalBody');
                        
                        modalBody.innerHTML = `
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Temel Bilgiler</h6>
                                    <table class="table table-sm">
                                        <tr><td>IP Adresi:</td><td>${device.ip}</td></tr>
                                        <tr><td>MAC Adresi:</td><td>${device.mac}</td></tr>
                                        <tr><td>Vendor:</td><td>${device.vendor || 'Bilinmeyen'}</td></tr>
                                        <tr><td>Cihaz Türü:</td><td>${device.device_type}</td></tr>
                                        <tr><td>Güven Seviyesi:</td><td><span class="badge bg-${getConfidenceColor(device.confidence)}">${device.confidence}%</span></td></tr>
                                        <tr><td>Durum:</td><td><span class="badge bg-success">${device.status}</span></td></tr>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <h6>Keşif Yöntemleri</h6>
                                    <div class="mb-3">
                                        ${device.discovery_methods ? device.discovery_methods.map(method => 
                                            `<span class="badge bg-primary me-1">${method}</span>`
                                        ).join('') : 'Bilgi yok'}
                                    </div>
                                    
                                    ${device.os_info ? `
                                        <h6>İşletim Sistemi</h6>
                                        <table class="table table-sm">
                                            <tr><td>OS:</td><td>${device.os_info.os_name}</td></tr>
                                            <tr><td>Doğruluk:</td><td>${device.os_info.os_accuracy}%</td></tr>
                                            <tr><td>Detay:</td><td>${device.os_info.os_line}</td></tr>
                                        </table>
                                    ` : ''}
                                </div>
                            </div>
                            
                            ${device.services && device.services.length > 0 ? `
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <h6>Açık Portlar ve Servisler</h6>
                                        <div class="table-responsive">
                                            <table class="table table-sm">
                                                <thead>
                                                    <tr>
                                                        <th>Port</th>
                                                        <th>Servis</th>
                                                        <th>Ürün</th>
                                                        <th>Versiyon</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${device.services.map(service => `
                                                        <tr>
                                                            <td>${service.port}</td>
                                                            <td>${service.service}</td>
                                                            <td>${service.product || '-'}</td>
                                                            <td>${service.version || '-'}</td>
                                                        </tr>
                                                    `).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${device.additional_info && Object.keys(device.additional_info).length > 0 ? `
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <h6>Ek Bilgiler</h6>
                                        ${Object.entries(device.additional_info).map(([key, value]) => `
                                            <div class="mb-2">
                                                <strong>${key.toUpperCase()}:</strong>
                                                <pre class="bg-light p-2 rounded">${JSON.stringify(value, null, 2)}</pre>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        `;
                        
                        new bootstrap.Modal(document.getElementById('deviceModal')).show();
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function updateStats() {
            const stats = document.getElementById('stats');
            if (devices.length === 0) {
                stats.innerHTML = '<p class="text-muted">Henüz tarama yapılmadı</p>';
                return;
            }

            const deviceTypes = {};
            const vendors = {};
            let totalPorts = 0;

            devices.forEach(device => {
                deviceTypes[device.device_type] = (deviceTypes[device.device_type] || 0) + 1;
                vendors[device.vendor] = (vendors[device.vendor] || 0) + 1;
                if (device.open_ports) {
                    totalPorts += device.open_ports.length;
                }
            });

            stats.innerHTML = `
                <div class="card stats-card mb-2">
                    <div class="card-body p-2">
                        <h6 class="mb-0">${devices.length} Cihaz</h6>
                    </div>
                </div>
                <div class="card stats-card mb-2">
                    <div class="card-body p-2">
                        <h6 class="mb-0">${totalPorts} Açık Port</h6>
                    </div>
                </div>
                <div class="card stats-card">
                    <div class="card-body p-2">
                        <h6 class="mb-0">${Object.keys(deviceTypes).length} Cihaz Türü</h6>
                    </div>
                </div>
            `;
        }

        function generateNetworkMap() {
            if (devices.length === 0) {
                alert('Önce tarama yapın!');
                return;
            }

            fetch('/api/network-map')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'ok') {
                        window.open(data.html_path, '_blank');
                    } else {
                        alert('Ağ haritası oluşturulamadı: ' + data.error);
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function generateReports() {
            if (devices.length === 0) {
                alert('Önce tarama yapın!');
                return;
            }

            fetch('/api/generate-reports', {method: 'POST'})
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'ok') {
                        alert('Raporlar oluşturuldu!');
                    } else {
                        alert('Rapor oluşturulamadı: ' + data.error);
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function showEmailModal() {
            if (devices.length === 0) {
                alert('Önce tarama yapın!');
                return;
            }
            new bootstrap.Modal(document.getElementById('emailModal')).show();
        }

        function sendEmail() {
            const toEmail = document.getElementById('emailTo').value;
            const reportType = document.getElementById('reportType').value;
            const smtpServer = document.getElementById('smtpServer').value;
            const smtpPort = document.getElementById('smtpPort').value;
            const smtpUser = document.getElementById('smtpUser').value;
            const smtpPass = document.getElementById('smtpPass').value;

            if (!toEmail || !smtpServer || !smtpUser || !smtpPass) {
                alert('Tüm alanları doldurun!');
                return;
            }

            const smtpConfig = {
                server: smtpServer,
                port: parseInt(smtpPort),
                username: smtpUser,
                password: smtpPass
            };

            fetch('/api/send-email', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    to_email: toEmail,
                    report_type: reportType,
                    smtp_config: smtpConfig
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok') {
                    alert('E-posta başarıyla gönderildi!');
                    bootstrap.Modal.getInstance(document.getElementById('emailModal')).hide();
                } else {
                    alert('E-posta gönderilemedi: ' + data.error);
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html> 