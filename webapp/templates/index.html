<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>IP Scanner V3.1 Web - Ağ Haritası</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
        }
        .network-map-container {
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 10px;
            margin: 20px 0;
            min-height: 400px;
        }
    </style>
</head>
<body class="bg-light">
<div class="container py-4">
    <h1 class="mb-4">IP Scanner V3.1 Web - Ağ Haritası</h1>
    
    <!-- Tarama Formu -->
    <form id="scanForm" class="row g-3 mb-3">
        <div class="col-auto">
            <input type="text" class="form-control" id="ipRange" placeholder="IP Aralığı (örn: 192.168.1.0/24)" value="192.168.1.0/24">
        </div>
        <div class="col-auto">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="portScan" checked>
                <label class="form-check-label" for="portScan">Port Tarama</label>
            </div>
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary">Taramayı Başlat</button>
        </div>
        <div class="col-auto">
            <button type="button" class="btn btn-info" onclick="generateNetworkMap()">Ağ Haritası Oluştur</button>
        </div>
        <div class="col-auto">
            <button type="button" class="btn btn-warning" onclick="showNetworkStats()">İstatistikler</button>
        </div>
        <div class="col-auto">
            <a href="/api/report" class="btn btn-success">Raporu İndir (JSON)</a>
        </div>
    </form>
    
    <div id="status" class="alert alert-info" style="display: none;"></div>
    
    <!-- İstatistikler -->
    <div id="statsSection" style="display: none;">
        <h3>Ağ İstatistikleri</h3>
        <div class="row" id="statsCards"></div>
    </div>
    
    <!-- Ağ Haritası -->
    <div id="networkMapSection" style="display: none;">
        <h3>Ağ Haritası</h3>
        <div class="network-map-container">
            <iframe id="networkMapFrame" width="100%" height="600" frameborder="0"></iframe>
        </div>
    </div>
    
    <!-- Cihaz Tablosu -->
    <h3>Cihaz Listesi</h3>
    <table class="table table-striped" id="devicesTable">
        <thead>
            <tr>
                <th>IP</th>
                <th>MAC</th>
                <th>Üretici</th>
                <th>Cihaz Türü</th>
                <th>Açık Portlar</th>
                <th>Durum</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
    document.getElementById('scanForm').onsubmit = async function(e) {
        e.preventDefault();
        showStatus('Tarama başlatıldı, lütfen bekleyin...', 'info');
        const ipRange = document.getElementById('ipRange').value;
        const portScan = document.getElementById('portScan').checked;
        const resp = await fetch('/api/scan', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ip_range: ipRange, port_scan: portScan})
        });
        const data = await resp.json();
        if (data.status === 'ok') {
            showStatus('Tarama tamamlandı!', 'success');
            updateTable(data.devices);
        } else {
            showStatus('Tarama başarısız!', 'danger');
        }
    };
    
    async function generateNetworkMap() {
        showStatus('Ağ haritası oluşturuluyor...', 'info');
        const resp = await fetch('/api/network-map');
        const data = await resp.json();
        if (data.status === 'ok') {
            showStatus('Ağ haritası oluşturuldu!', 'success');
            document.getElementById('networkMapFrame').src = data.html_path;
            document.getElementById('networkMapSection').style.display = 'block';
        } else {
            showStatus('Ağ haritası oluşturulamadı: ' + data.error, 'danger');
        }
    }
    
    async function showNetworkStats() {
        const resp = await fetch('/api/network-stats');
        const data = await resp.json();
        if (data.status === 'ok') {
            displayStats(data.stats);
            document.getElementById('statsSection').style.display = 'block';
        } else {
            showStatus('İstatistikler alınamadı: ' + data.error, 'danger');
        }
    }
    
    function displayStats(stats) {
        const statsCards = document.getElementById('statsCards');
        statsCards.innerHTML = '';
        
        // Toplam cihaz sayısı
        statsCards.innerHTML += `
            <div class="col-md-3">
                <div class="stats-card">
                    <h4>${stats.total_devices}</h4>
                    <p>Toplam Cihaz</p>
                </div>
            </div>
        `;
        
        // Cihaz türleri
        const deviceTypes = Object.entries(stats.device_types);
        if (deviceTypes.length > 0) {
            statsCards.innerHTML += `
                <div class="col-md-3">
                    <div class="stats-card">
                        <h4>${deviceTypes.length}</h4>
                        <p>Cihaz Türü</p>
                        <small>${deviceTypes.map(([type, count]) => `${type}: ${count}`).join(', ')}</small>
                    </div>
                </div>
            `;
        }
        
        // Üreticiler
        const vendors = Object.entries(stats.vendors);
        if (vendors.length > 0) {
            statsCards.innerHTML += `
                <div class="col-md-3">
                    <div class="stats-card">
                        <h4>${vendors.length}</h4>
                        <p>Üretici</p>
                        <small>${vendors.map(([vendor, count]) => `${vendor}: ${count}`).join(', ')}</small>
                    </div>
                </div>
            `;
        }
        
        // Açık portlar
        const openPorts = Object.entries(stats.open_ports);
        if (openPorts.length > 0) {
            statsCards.innerHTML += `
                <div class="col-md-3">
                    <div class="stats-card">
                        <h4>${openPorts.length}</h4>
                        <p>Açık Port</p>
                        <small>${openPorts.map(([port, count]) => `${port}: ${count}`).join(', ')}</small>
                    </div>
                </div>
            `;
        }
    }
    
    function showStatus(message, type) {
        const statusDiv = document.getElementById('status');
        statusDiv.textContent = message;
        statusDiv.className = `alert alert-${type}`;
        statusDiv.style.display = 'block';
        setTimeout(() => {
            statusDiv.style.display = 'none';
        }, 5000);
    }
    
    async function fetchDevices() {
        const resp = await fetch('/api/devices');
        const data = await resp.json();
        updateTable(data.devices);
    }
    
    function updateTable(devices) {
        const tbody = document.querySelector('#devicesTable tbody');
        tbody.innerHTML = '';
        for (const dev of devices) {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${dev.ip}</td><td>${dev.mac}</td><td>${dev.vendor}</td><td>${dev.device_type}</td><td>${dev.open_ports && dev.open_ports.length ? dev.open_ports.join(', ') : 'Yok'}</td><td>${dev.status}</td>`;
            tbody.appendChild(row);
        }
    }
    
    fetchDevices();
</script>
</body>
</html> 